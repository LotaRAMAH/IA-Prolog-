<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Syst√®me d'Enqu√™te Polici√®re</title>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --light-color: #ecf0f1;
            --dark-color: #34495e;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --danger-color: #c0392b;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--dark-color) 0%, var(--primary-color) 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1rem;
            opacity: 0.9;
        }
        
        .main-content {
            display: flex;
            padding: 20px;
            gap: 20px;
        }
        
        .panel {
            background: var(--light-color);
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            height: fit-content;
        }
        
        .panel-title {
            font-size: 1.2rem;
            color: var(--primary-color);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--secondary-color);
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--dark-color);
        }
        
        select, input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }
        
        button {
            background: var(--secondary-color);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.3s;
        }
        
        button:hover {
            background: var(--primary-color);
        }
        
        button:disabled {
            background: #95a5a6;
            cursor: not-allowed;
        }
        
        .connection-status {
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .status-connected {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .suspects-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }
        
        .suspect-card {
            background: white;
            border-radius: 8px;
            padding: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        
        .suspect-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .suspect-card.selected {
            border-color: var(--secondary-color);
            background: #e8f4fd;
        }
        
        .verdict-display {
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            margin: 20px 0;
            display: none;
        }
        
        .verdict-guilty {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .verdict-not-guilty {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .facts-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }
        
        .fact-item {
            background: white;
            border-radius: 5px;
            padding: 10px;
            font-size: 0.9rem;
        }
        
        .detail-item {
            margin-bottom: 10px;
        }
        
        .detail-label {
            font-weight: 600;
            color: var(--dark-color);
        }
        
        .profile-display {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }
        
        .profile-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .profile-avatar {
            font-size: 2.5rem;
            margin-right: 15px;
        }
        
        .profile-info {
            flex: 1;
        }
        
        .profile-name {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .profile-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        .profile-detail {
            background: #f8f9fa;
            border-radius: 5px;
            padding: 10px;
        }
        
        .profile-detail-label {
            font-weight: 600;
            color: var(--dark-color);
            margin-bottom: 5px;
        }
        
        .evidence-section {
            margin-top: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            display: none;
        }
        
        .evidence-checkbox {
            margin-bottom: 10px;
        }
        
        .evidence-checkbox label {
            display: flex;
            align-items: center;
            font-weight: normal;
            cursor: pointer;
        }
        
        .evidence-checkbox input {
            width: auto;
            margin-right: 10px;
            cursor: pointer;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--secondary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Layout √† trois colonnes */
        .col-left {
            flex: 1;
        }
        
        .col-center {
            flex: 1;
        }
        
        .col-right {
            flex: 1;
        }
        
        @media (max-width: 992px) {
            .main-content {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîç Syst√®me d'Enqu√™te Polici√®re</h1>
            <p>Analyse de cas criminels avec base de donn√©es de preuves</p>
        </div>

        <div class="main-content">
            <!-- Colonne de gauche : Configuration de l'enqu√™te -->
            <div class="col-left">
                <div class="panel">
                    <h2 class="panel-title">üìã Configuration de l'enqu√™te</h2>
                    
                    <div id="connection-status" class="connection-status status-error">
                        ‚ö†Ô∏è Serveur non connect√©
                    </div>

                    <div class="form-group">
                        <label for="prolog-url">URL du serveur :</label>
                        <input type="text" id="prolog-url" value="http://localhost:8080">
                    </div>
                    
                    <button id="test-connection-btn">Tester la connexion</button>
                    
                    <div class="form-group">
                        <label for="crime">Type de crime :</label>
                        <select id="crime">
                            <option value="">-- S√©lectionnez --</option>
                            <option value="vol">Vol</option>
                            <option value="assassinat">Assassinat</option>
                            <option value="escroquerie">Escroquerie</option>
                        </select>
                    </div>
                    
                    <h3 style="margin: 15px 0 10px 0;">Suspects :</h3>
                    <div class="suspects-grid">
                        <div class="suspect-card" data-suspect="john">
                            <div>üë®‚Äçüíº</div>
                            <div>John</div>
                        </div>
                        <div class="suspect-card" data-suspect="mary">
                            <div>üë©‚Äç‚öïÔ∏è</div>
                            <div>Mary</div>
                        </div>
                        <div class="suspect-card" data-suspect="alice">
                            <div>üë©‚Äçüíª</div>
                            <div>Alice</div>
                        </div>
                        <div class="suspect-card" data-suspect="bruno">
                            <div>üë®‚Äçüíº</div>
                            <div>Bruno</div>
                        </div>
                        <div class="suspect-card" data-suspect="sophie">
                            <div>üë©‚Äçüé®</div>
                            <div>Sophie</div>
                        </div>
                        <div class="suspect-card" data-suspect="x">
                            <div>‚ùì</div>
                            <div>X</div>
                        </div>
                    </div>
                    
                    <div id="evidence-vol" class="evidence-section">
                        <h4>Preuves pour le vol :</h4>
                        <div class="evidence-checkbox">
                            <label>
                                <input type="checkbox" name="evidence" value="has_motive"> Mobile (dettes importantes)
                            </label>
                        </div>
                        <div class="evidence-checkbox">
                            <label>
                                <input type="checkbox" name="evidence" value="was_near_crime_scene"> Pr√©sent sur les lieux
                            </label>
                        </div>
                        <div class="evidence-checkbox">
                            <label>
                                <input type="checkbox" name="evidence" value="has_fingerprint_on_weapon"> Empreintes sur l'arme/outil
                            </label>
                        </div>
                    </div>
                    
                    <div id="evidence-assassinat" class="evidence-section">
                        <h4>Preuves pour l'assassinat :</h4>
                        <div class="evidence-checkbox">
                            <label>
                                <input type="checkbox" name="evidence" value="has_motive"> Mobile (vengeance)
                            </label>
                        </div>
                        <div class="evidence-checkbox">
                            <label>
                                <input type="checkbox" name="evidence" value="was_near_crime_scene"> Pr√©sent sur les lieux
                            </label>
                        </div>
                        <div class="evidence-checkbox">
                            <label>
                                <input type="checkbox" name="evidence" value="has_fingerprint_on_weapon"> Empreintes sur l'arme
                            </label>
                        </div>
                        <div class="evidence-checkbox">
                            <label>
                                <input type="checkbox" name="evidence" value="eyewitness_identification"> T√©moin oculaire
                            </label>
                        </div>
                    </div>
                    
                    <div id="evidence-escroquerie" class="evidence-section">
                        <h4>Preuves pour l'escroquerie :</h4>
                        <div class="evidence-checkbox">
                            <label>
                                <input type="checkbox" name="evidence" value="has_motive"> Mobile (probl√®mes financiers)
                            </label>
                        </div>
                        <div class="evidence-checkbox">
                            <label>
                                <input type="checkbox" name="evidence" value="has_bank_transaction"> Transactions bancaires suspectes
                            </label>
                        </div>
                        <div class="evidence-checkbox">
                            <label>
                                <input type="checkbox" name="evidence" value="owns_fake_identity"> Fausse identit√©
                            </label>
                        </div>
                    </div>
                    
                    <button id="investigate-btn" style="margin-top: 20px; width: 100%;">
                        Lancer l'enqu√™te
                    </button>
                </div>
            </div>
            
            <!-- Colonne centrale : Profil du suspect et faits connus -->
            <div class="col-center">
                <div class="panel">
                    <h2 class="panel-title">üë§ Profil du suspect</h2>
                    <div id="suspect-profile" class="profile-display">
                        <div class="profile-header">
                            <div id="profile-avatar" class="profile-avatar">üë§</div>
                            <div class="profile-info">
                                <div id="profile-name" class="profile-name">Nom du suspect</div>
                                <div id="profile-description">Description du suspect</div>
                            </div>
                        </div>
                        <div class="profile-details">
                            <div class="profile-detail">
                                <div class="profile-detail-label">√Çge</div>
                                <div id="profile-age">-</div>
                            </div>
                            <div class="profile-detail">
                                <div class="profile-detail-label">Profession</div>
                                <div id="profile-job">-</div>
                            </div>
                            <div class="profile-detail">
                                <div class="profile-detail-label">Mobile connu</div>
                                <div id="profile-motive">Aucun</div>
                            </div>
                            <div class="profile-detail">
                                <div class="profile-detail-label">Statut</div>
                                <div id="profile-status">Non enqu√™t√©</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="panel">
                    <h2 class="panel-title">üìä Faits connus</h2>
                    <div id="key-facts">
                        <p>S√©lectionnez un crime et un suspect pour voir les faits.</p>
                    </div>
                </div>
            </div>
            
            <!-- Colonne de droite : R√©sultats de l'enqu√™te -->
            <div class="col-right">
                <div class="panel">
                    <h2 class="panel-title">‚öñÔ∏è R√©sultats de l'enqu√™te</h2>
                    
                    <div id="verdict-loading" style="text-align: center; padding: 20px; display: none;">
                        <div class="loading"></div>
                        <p>Analyse en cours...</p>
                    </div>
                    
                    <div id="verdict-guilty" class="verdict-display verdict-guilty">
                        <h3>üö® COUPABLE</h3>
                        <p>Le suspect est probablement coupable</p>
                    </div>
                    
                    <div id="verdict-not-guilty" class="verdict-display verdict-not-guilty">
                        <h3>‚úÖ NON COUPABLE</h3>
                        <p>Preuves insuffisantes pour inculper le suspect</p>
                    </div>
                    
                    <div id="case-details">
                        <h3 style="margin: 20px 0 10px 0;">D√©tails de l'enqu√™te :</h3>
                        <div class="detail-item">
                            <span class="detail-label">Mobile :</span>
                            <span id="motive-content">Non d√©termin√©</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Alibi :</span>
                            <span id="alibi-content">Non v√©rifi√©</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Preuves :</span>
                            <span id="evidence-content">Aucune preuve</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Donn√©es des suspects 
        const suspectProfiles = {
            john: {
                name: 'John Martinez',
                age: 35,
                job: 'Comptable',
                description: 'Homme calme mais cribl√© de dettes',
                avatar: 'üë®‚Äçüíº',
                motives: {
                    vol: 'Dettes de jeu importantes',
                    escroquerie: 'Acc√®s aux comptes de l\'entreprise'
                },
                // Faits fixes selon le sujet initial
                facts: {
                    vol: {
                        has_motive: true,
                        was_near_crime_scene: true,
                        has_fingerprint_on_weapon: true,
                        is_guilty: true
                    },
                    assassinat: {
                        has_motive: false,
                        was_near_crime_scene: false,
                        has_fingerprint_on_weapon: false,
                        is_guilty: false
                    },
                    escroquerie: {
                        has_motive: false,
                        has_bank_transaction: false,
                        is_guilty: false
                    }
                }
            },
            mary: {
                name: 'Mary Johnson', 
                age: 28,
                job: 'Infirmi√®re',
                description: 'Temp√©rament violent, r√©cemment licenci√©e',
                avatar: 'üë©‚Äç‚öïÔ∏è',
                motives: {
                    assassinat: 'Vengeance professionnelle'
                },
                // Faits fixes selon le sujet initial
                facts: {
                    vol: {
                        has_motive: false,
                        was_near_crime_scene: false,
                        has_fingerprint_on_weapon: false,
                        is_guilty: false
                    },
                    assassinat: {
                        has_motive: true,
                        was_near_crime_scene: true,
                        has_fingerprint_on_weapon: true,
                        is_guilty: true
                    },
                    escroquerie: {
                        has_motive: false,
                        has_bank_transaction: false,
                        is_guilty: false
                    }
                }
            },
            alice: {
                name: 'Alice Chen',
                age: 42, 
                job: 'Informaticienne',
                description: 'Experte syst√®mes financiers, divorce difficile',
                avatar: 'üë©‚Äçüíª',
                motives: {
                    escroquerie: 'Difficult√©s financi√®res personnelles'
                },
                // Faits fixes selon le sujet initial
                facts: {
                    vol: {
                        has_motive: false,
                        was_near_crime_scene: false,
                        has_fingerprint_on_weapon: false,
                        is_guilty: false
                    },
                    assassinat: {
                        has_motive: false,
                        was_near_crime_scene: false,
                        has_fingerprint_on_weapon: false,
                        is_guilty: false
                    },
                    escroquerie: {
                        has_motive: true,
                        has_bank_transaction: true,
                        is_guilty: true
                    }
                }
            },
            bruno: {
                name: 'Bruno Dubois',
                age: 38,
                job: 'Banquier',
                description: 'Acc√®s privil√©gi√© aux syst√®mes bancaires',
                avatar: 'üë®‚Äçüíº',
                motives: {
                    escroquerie: 'Connaissance des failles de s√©curit√©'
                },
                // Faits fixes selon le sujet initial
                facts: {
                    vol: {
                        has_motive: false,
                        was_near_crime_scene: false,
                        has_fingerprint_on_weapon: false,
                        is_guilty: false
                    },
                    assassinat: {
                        has_motive: false,
                        was_near_crime_scene: false,
                        has_fingerprint_on_weapon: false,
                        is_guilty: false
                    },
                    escroquerie: {
                        has_motive: false,
                        has_bank_transaction: true,
                        is_guilty: false // Selon le sujet, Bruno a des transactions mais n'est pas d√©clar√© coupable
                    }
                }
            },
            sophie: {
                name: 'Sophie Martin',
                age: 31,
                job: 'Graphiste',
                description: 'Expertise en falsification de documents',
                avatar: 'üë©‚Äçüé®',
                motives: {
                    escroquerie: 'Comp√©tences professionnelles en design graphique'
                },
                // Faits fixes selon le sujet initial
                facts: {
                    vol: {
                        has_motive: false,
                        was_near_crime_scene: false,
                        has_fingerprint_on_weapon: false,
                        is_guilty: false
                    },
                    assassinat: {
                        has_motive: false,
                        was_near_crime_scene: false,
                        has_fingerprint_on_weapon: false,
                        is_guilty: false
                    },
                    escroquerie: {
                        has_motive: false,
                        owns_fake_identity: true,
                        is_guilty: false // Selon le sujet, Sophie a une fausse identit√© mais n'est pas d√©clar√©e coupable
                    }
                }
            },
            x: {
                name: 'X (Inconnu)',
                age: 'Inconnu',
                job: 'Inconnue',
                description: 'Suspect non identifi√© - Preuves √† v√©rifier',
                avatar: '‚ùì',
                motives: {},
                // Pour X, les faits seront d√©termin√©s par les preuves s√©lectionn√©es
                facts: {
                    vol: { is_guilty: false },
                    assassinat: { is_guilty: false },
                    escroquerie: { is_guilty: false }
                }
            }
        };

        // √âl√©ments DOM
        const connectionStatus = document.getElementById('connection-status');
        const testConnectionBtn = document.getElementById('test-connection-btn');
        const investigateBtn = document.getElementById('investigate-btn');
        const crimeSelect = document.getElementById('crime');
        const suspectCards = document.querySelectorAll('.suspect-card');
        const keyFacts = document.getElementById('key-facts');
        const verdictLoading = document.getElementById('verdict-loading');
        const verdictGuilty = document.getElementById('verdict-guilty');
        const verdictNotGuilty = document.getElementById('verdict-not-guilty');
        const motiveContent = document.getElementById('motive-content');
        const alibiContent = document.getElementById('alibi-content');
        const evidenceContent = document.getElementById('evidence-content');
        
        // √âl√©ments du profil
        const suspectProfile = document.getElementById('suspect-profile');
        const profileAvatar = document.getElementById('profile-avatar');
        const profileName = document.getElementById('profile-name');
        const profileDescription = document.getElementById('profile-description');
        const profileAge = document.getElementById('profile-age');
        const profileJob = document.getElementById('profile-job');
        const profileMotive = document.getElementById('profile-motive');
        const profileStatus = document.getElementById('profile-status');
        
        // Sections de preuves
        const evidenceVol = document.getElementById('evidence-vol');
        const evidenceAssassinat = document.getElementById('evidence-assassinat');
        const evidenceEscroquerie = document.getElementById('evidence-escroquerie');

        let selectedSuspect = null;
        let isConnected = false;

        // Initialisation
        function init() {
            testConnectionBtn.addEventListener('click', testConnection);
            investigateBtn.addEventListener('click', launchInvestigation);
            crimeSelect.addEventListener('change', updateCrimeSelection);
            
            suspectCards.forEach(card => {
                card.addEventListener('click', () => {
                    selectSuspect(card.dataset.suspect);
                });
            });
            
            // Cacher les verdicts au d√©part
            verdictGuilty.style.display = 'none';
            verdictNotGuilty.style.display = 'none';
            
            // Cacher toutes les sections de preuves au d√©part
            evidenceVol.style.display = 'none';
            evidenceAssassinat.style.display = 'none';
            evidenceEscroquerie.style.display = 'none';
        }

        // Mettre √† jour la s√©lection du crime
        function updateCrimeSelection() {
            const crime = crimeSelect.value;
            
            // Cacher toutes les sections de preuves
            evidenceVol.style.display = 'none';
            evidenceAssassinat.style.display = 'none';
            evidenceEscroquerie.style.display = 'none';
            
            // Afficher la section appropri√©e seulement si le suspect X est s√©lectionn√©
            if (selectedSuspect === 'x') {
                if (crime === 'vol') {
                    evidenceVol.style.display = 'block';
                } else if (crime === 'assassinat') {
                    evidenceAssassinat.style.display = 'block';
                } else if (crime === 'escroquerie') {
                    evidenceEscroquerie.style.display = 'block';
                }
            }
            
            updatePreliminaryFacts();
        }

        // Tester la connexion au serveur
        async function testConnection() {
            const url = document.getElementById('prolog-url').value;
            if (!url) {
                showConnectionStatus(false, 'URL du serveur manquante');
                return;
            }
            
            showConnectionStatus(false, 'Connexion en cours...');
            testConnectionBtn.disabled = true;
            
            try {
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                
                const success = Math.random() > 0.2; 
                
                if (success) {
                    showConnectionStatus(true, 'Connect√© au serveur d\'enqu√™te');
                    isConnected = true;
                } else {
                    throw new Error('Impossible de se connecter au serveur');
                }
            } catch (error) {
                showConnectionStatus(false, error.message);
                isConnected = false;
            } finally {
                testConnectionBtn.disabled = false;
            }
        }

        // Afficher le statut de connexion
        function showConnectionStatus(connected, message) {
            if (connected) {
                connectionStatus.className = 'connection-status status-connected';
                connectionStatus.innerHTML = `‚úÖ ${message}`;
            } else {
                connectionStatus.className = 'connection-status status-error';
                connectionStatus.innerHTML = `‚ùå ${message}`;
            }
        }

        // S√©lectionner un suspect
        function selectSuspect(suspect) {
            selectedSuspect = suspect;
            
            // Mettre √† jour l'interface
            suspectCards.forEach(card => {
                if (card.dataset.suspect === suspect) {
                    card.classList.add('selected');
                } else {
                    card.classList.remove('selected');
                }
            });
            
            // Afficher ou cacher les preuves selon le suspect s√©lectionn√©
            updateEvidenceDisplay();
            
            // Afficher le profil du suspect
            displaySuspectProfile(suspect);
            
            updatePreliminaryFacts();
        }

        // Mettre √† jour l'affichage des preuves selon le suspect s√©lectionn√©
        function updateEvidenceDisplay() {
            const crime = crimeSelect.value;
            
            // Cacher toutes les sections de preuves
            evidenceVol.style.display = 'none';
            evidenceAssassinat.style.display = 'none';
            evidenceEscroquerie.style.display = 'none';
            
            // Afficher la section appropri√©e seulement si le suspect X est s√©lectionn√©
            if (selectedSuspect === 'x' && crime) {
                if (crime === 'vol') {
                    evidenceVol.style.display = 'block';
                } else if (crime === 'assassinat') {
                    evidenceAssassinat.style.display = 'block';
                } else if (crime === 'escroquerie') {
                    evidenceEscroquerie.style.display = 'block';
                }
            }
        }

        // Afficher le profil du suspect s√©lectionn√©
        function displaySuspectProfile(suspect) {
            const profile = suspectProfiles[suspect];
            
            if (profile) {
                profileAvatar.textContent = profile.avatar;
                profileName.textContent = profile.name;
                profileDescription.textContent = profile.description;
                profileAge.textContent = profile.age;
                profileJob.textContent = profile.job;
                
                // Afficher le mobile selon le crime s√©lectionn√©
                const crime = crimeSelect.value;
                if (crime && profile.motives[crime]) {
                    profileMotive.textContent = profile.motives[crime];
                } else {
                    profileMotive.textContent = 'Aucun mobile connu';
                }
                
                profileStatus.textContent = 'Suspect s√©lectionn√©';
                
                // Afficher le profil
                suspectProfile.style.display = 'block';
            }
        }

        // Mettre √† jour les faits pr√©liminaires (bas√©s sur les faits fixes du sujet)
        function updatePreliminaryFacts() {
            const crime = crimeSelect.value;
            
            if (!crime || !selectedSuspect) {
                keyFacts.innerHTML = '<p>S√©lectionnez un crime et un suspect pour voir les faits.</p>';
                return;
            }
            
            const suspect = suspectProfiles[selectedSuspect];
            
            // Pour le suspect X, afficher les preuves s√©lectionn√©es
            if (selectedSuspect === 'x') {
                let factsHTML = '<div class="facts-grid">';
                const evidenceCheckboxes = document.querySelectorAll('input[name="evidence"]:checked');
                
                if (evidenceCheckboxes.length === 0) {
                    factsHTML += '<div class="fact-item">‚ùå Aucune preuve</div>';
                } else {
                    evidenceCheckboxes.forEach(checkbox => {
                        let factText = '';
                        switch(checkbox.value) {
                            case 'has_motive':
                                factText = '‚úÖ Mobile identifi√©';
                                break;
                            case 'was_near_crime_scene':
                                factText = '‚úÖ Pr√©sent sur les lieux';
                                break;
                            case 'has_fingerprint_on_weapon':
                                factText = '‚úÖ Empreintes sur arme/outil';
                                break;
                            case 'eyewitness_identification':
                                factText = '‚úÖ T√©moin oculaire';
                                break;
                            case 'has_bank_transaction':
                                factText = '‚úÖ Transactions suspectes';
                                break;
                            case 'owns_fake_identity':
                                factText = '‚úÖ Fausse identit√©';
                                break;
                        }
                        factsHTML += `<div class="fact-item">${factText}</div>`;
                    });
                }
                
                factsHTML += '</div>';
                keyFacts.innerHTML = factsHTML;
                
                // Mettre √† jour le mobile dans le profil
                const hasMotive = document.querySelector('input[name="evidence"][value="has_motive"]:checked');
                profileMotive.textContent = hasMotive ? 'Mobile identifi√© (d√©pend du crime)' : 'Aucun mobile identifi√©';
                
                return;
            }
            
            let factsHTML = '<div class="facts-grid">';
            
            // V√©rifier les faits selon le sujet initial
            const facts = suspect.facts[crime];
            
            // Mobile
            if (facts.has_motive) {
                factsHTML += `<div class="fact-item">‚úÖ Mobile: ${suspect.motives[crime] || 'Mobile connu'}</div>`;
            } else {
                factsHTML += '<div class="fact-item">‚ùå Aucun mobile connu</div>';
            }
            
            // Pr√©sence sur les lieux (pour vol et assassinat)
            if (crime === 'vol' || crime === 'assassinat') {
                if (facts.was_near_crime_scene) {
                    factsHTML += '<div class="fact-item">‚úÖ Pr√©sent pr√®s des lieux</div>';
                } else {
                    factsHTML += '<div class="fact-item">‚ùå Absent des lieux</div>';
                }
            }
            
            // Empreintes sur l'arme (pour vol et assassinat)
            if (crime === 'vol' || crime === 'assassinat') {
                if (facts.has_fingerprint_on_weapon) {
                    factsHTML += '<div class="fact-item">‚úÖ Empreintes sur arme/outil</div>';
                } else {
                    factsHTML += '<div class="fact-item">‚ùå Aucune empreinte</div>';
                }
            }
            
            // Transactions bancaires (pour escroquerie)
            if (crime === 'escroquerie') {
                if (facts.has_bank_transaction) {
                    factsHTML += '<div class="fact-item">‚úÖ Transactions suspectes</div>';
                } else if (facts.owns_fake_identity) {
                    factsHTML += '<div class="fact-item">‚úÖ Fausse identit√©</div>';
                } else {
                    factsHTML += '<div class="fact-item">‚ùå Aucune activit√© suspecte</div>';
                }
            }
            
            factsHTML += '</div>';
            keyFacts.innerHTML = factsHTML;
            
            // Mettre √† jour le mobile dans le profil
            if (suspect.motives[crime]) {
                profileMotive.textContent = suspect.motives[crime];
            } else {
                profileMotive.textContent = 'Aucun mobile connu';
            }
        }

        // Lancer l'enqu√™te (bas√©e sur les faits fixes du sujet)
        async function launchInvestigation() {
            const crime = crimeSelect.value;
            
            if (!crime) {
                alert('Veuillez s√©lectionner un type de crime');
                return;
            }
            
            if (!selectedSuspect) {
                alert('Veuillez s√©lectionner un suspect');
                return;
            }
            
            if (!isConnected) {
                alert('Veuillez d\'abord √©tablir une connexion au serveur');
                return;
            }
            
            // Cacher les r√©sultats pr√©c√©dents
            verdictGuilty.style.display = 'none';
            verdictNotGuilty.style.display = 'none';
            verdictLoading.style.display = 'block';
            investigateBtn.disabled = true;
            
            // Mettre √† jour le statut du profil
            profileStatus.textContent = 'Enqu√™te en cours...';
            
            try {
                // Pour le suspect X, envoyer les preuves s√©lectionn√©es au serveur
                if (selectedSuspect === 'x') {
                    const evidenceCheckboxes = document.querySelectorAll('input[name="evidence"]:checked');
                    const evidence = Array.from(evidenceCheckboxes).map(cb => cb.value);
                    
                    // Simulation d'appel au serveur Prolog
                    await new Promise(resolve => setTimeout(resolve, 2000));
                    
                    // D√©terminer la culpabilit√© selon les r√®gles Prolog
                    let isGuilty = false;
                    let evidenceDetails = `Preuves: ${evidence.join(', ')}`;
                    

                    if (crime === 'vol') {
                        // R√®gle pour le vol: (mobile et empreinte) ou (pr√©sence et empreinte)
                        const hasMotive = evidence.includes('has_motive');
                        const wasNearScene = evidence.includes('was_near_crime_scene');
                        const hasFingerprints = evidence.includes('has_fingerprint_on_weapon');
                        
                        isGuilty = hasFingerprints && (hasMotive || wasNearScene);
                        
                        if (isGuilty) {
                            evidenceDetails = 'Preuves: empreintes + ';
                            if (hasMotive && wasNearScene) {
                                evidenceDetails += 'mobile ET pr√©sence sur les lieux';
                            } else if (hasMotive) {
                                evidenceDetails += 'mobile';
                            } else {
                                evidenceDetails += 'pr√©sence sur les lieux';
                            }
                        } else {
                            evidenceDetails = 'Preuves manquantes: ';
                            if (!hasFingerprints) evidenceDetails += 'empreintes, ';
                            if (!hasMotive && !wasNearScene) evidenceDetails += 'mobile OU pr√©sence sur les lieux';
                            evidenceDetails = evidenceDetails.replace(/, $/, ''); // Enlever la derni√®re virgule
                        }
                    } else if (crime === 'assassinat') {
                        // R√®gle pour l'assassinat: (empreintes OU t√©moin) ET (mobile OU pr√©sence) OU (empreintes ET t√©moin)
                        const hasMotive = evidence.includes('has_motive');
                        const wasNearScene = evidence.includes('was_near_crime_scene');
                        const hasFingerprints = evidence.includes('has_fingerprint_on_weapon');
                        const hasWitness = evidence.includes('eyewitness_identification');
                        
                        // DEBUG: Afficher les valeurs pour v√©rification
                        console.log('Preuves s√©lectionn√©es:', evidence);
                        console.log('Mobile:', hasMotive, 'Pr√©sence:', wasNearScene, 'Empreintes:', hasFingerprints, 'T√©moin:', hasWitness);
                        
                        // Condition 1: (empreintes OU t√©moin) ET (mobile OU pr√©sence)
                        const condition1 = (hasFingerprints || hasWitness) && (hasMotive || wasNearScene);
                        
                        // Condition 2: empreintes ET t√©moin
                        const condition2 = hasFingerprints && hasWitness;
                        
                        isGuilty = condition1 || condition2;
                        
                        // DEBUG: Afficher les conditions
                        console.log('Condition 1:', condition1, 'Condition 2:', condition2, 'Coupable:', isGuilty);
                        
                        if (isGuilty) {
                            evidenceDetails = 'Preuves: ';
                            if (condition2) {
                                evidenceDetails += 'empreintes ET t√©moin oculaire';
                            } else {
                                if (hasFingerprints || hasWitness) {
                                    evidenceDetails += (hasFingerprints ? 'empreintes' : 't√©moin oculaire');
                                }
                                if ((hasFingerprints || hasWitness) && (hasMotive || wasNearScene)) {
                                    evidenceDetails += ' + ';
                                }
                                if (hasMotive || wasNearScene) {
                                    evidenceDetails += (hasMotive ? 'mobile' : 'pr√©sence sur les lieux');
                                }
                            }
                        } else {
                            evidenceDetails = 'Preuves insuffisantes: ';
                            const missingParts = [];
                            
                            if (!hasFingerprints && !hasWitness) {
                                missingParts.push('empreintes OU t√©moin oculaire');
                            }
                            if (!hasMotive && !wasNearScene && !(hasFingerprints && hasWitness)) {
                                missingParts.push('mobile OU pr√©sence sur les lieux');
                            }
                            
                            evidenceDetails += missingParts.join(' ET ');
                        }
                    } else if (crime === 'escroquerie') {
                        // R√®gle pour l'escroquerie: (mobile + transactions) OU fausse identit√©
                        const hasMotive = evidence.includes('has_motive');
                        const hasTransactions = evidence.includes('has_bank_transaction');
                        const hasFakeID = evidence.includes('owns_fake_identity');
                        isGuilty = (hasMotive && hasTransactions) || hasFakeID;
                        
                        if (isGuilty) {
                            if (hasMotive && hasTransactions && hasFakeID) {
                                evidenceDetails = 'Preuves: mobile + transactions + fausse identit√©';
                            } else if (hasMotive && hasTransactions) {
                                evidenceDetails = 'Preuves: mobile + transactions';
                            } else {
                                evidenceDetails = 'Preuves: fausse identit√©';
                            }
                        } else {
                            evidenceDetails = 'Preuves manquantes: ';
                            if (hasMotive && !hasTransactions) evidenceDetails += 'transactions bancaires suspectes';
                            else if (!hasMotive && hasTransactions) evidenceDetails += 'mobile';
                            else if (!hasFakeID) evidenceDetails += 'fausse identit√©';
                            else evidenceDetails += 'mobile+transactions OU fausse identit√©';
                        }
                    }
                    
                    // Afficher le r√©sultat
                    if (isGuilty) {
                        verdictGuilty.style.display = 'block';
                        motiveContent.textContent = evidence.includes('has_motive') ? 'Mobile identifi√©' : 'Aucun mobile identifi√©';
                        alibiContent.textContent = 'Non corrobor√©';
                        evidenceContent.textContent = evidenceDetails;
                        profileStatus.textContent = 'Coupable - Inculpation recommand√©e';
                    } else {
                        verdictNotGuilty.style.display = 'block';
                        motiveContent.textContent = evidence.includes('has_motive') ? 'Mobile identifi√©' : 'Aucun mobile cr√©dible';
                        alibiContent.textContent = 'V√©rifi√©';
                        evidenceContent.textContent = evidenceDetails;
                        profileStatus.textContent = 'Non coupable - Classement recommand√©';
                    }
                } else {
                    // Pour les autres suspects, utiliser les faits fixes
                    await new Promise(resolve => setTimeout(resolve, 2000));
                    
                    // Bas√© sur les faits fixes du sujet initial
                    const suspect = suspectProfiles[selectedSuspect];
                    const isGuilty = suspect.facts[crime].is_guilty;
                    
                    // Afficher le r√©sultat
                    if (isGuilty) {
                        verdictGuilty.style.display = 'block';
                        motiveContent.textContent = suspect.motives[crime] || 'Mobile identifi√©';
                        alibiContent.textContent = 'Non corrobor√©';
                        evidenceContent.textContent = 'Preuves mat√©rielles';
                        profileStatus.textContent = 'Coupable - Inculpation recommand√©e';
                    } else {
                        verdictNotGuilty.style.display = 'block';
                        motiveContent.textContent = suspect.facts[crime].has_motive ? suspect.motives[crime] : 'Aucun mobile cr√©dible';
                        alibiContent.textContent = 'V√©rifi√©';
                        evidenceContent.textContent = 'Insuffisantes pour inculpation';
                        profileStatus.textContent = 'Non coupable - Classement recommand√©';
                    }
                }
            } catch (error) {
                alert('Erreur lors de l\'enqu√™te: ' + error.message);
                profileStatus.textContent = 'Erreur lors de l\'enqu√™te';
            } finally {
                verdictLoading.style.display = 'none';
                investigateBtn.disabled = false;
            }
        }

        // Initialiser l'application
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>